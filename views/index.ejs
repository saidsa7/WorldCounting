<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body class="bg-slate-900 text-slate-200 font-sans">
    <%- include('components/navbar',{currentPage : "home"}) %>
    <!-- sidebar -->
    <%- include('components/sidebar') %>
    <!-- Form -->
    <form action="/add" method="POST" class="mt-10 mx-auto max-w-4xl">
      <input
        type="text"
        id="title"
        name="title"
        placeholder="Text Title"
        class="mb-4 w-full border rounded-lg p-3 border-none bg-slate-800 text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500"
      />
      <textarea
        oninput="counting()"
        id="myText"
        name="text"
        class="border border-slate-700 rounded-lg p-5 w-full h-48 bg-slate-800 text-slate-100 leading-relaxed text-lg placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500 resize-none"
        placeholder="Put your text here.."
      ></textarea>

      <div class="mt-6 flex gap-10 items-center">
        <div
          class="bg-cyan-700 flex justify-center items-center p-3 rounded-sm"
        >
          Total Words: <span id="total" class="ml-2 text-3xl"></span>
        </div>
        <div
          class="bg-cyan-700 flex justify-center items-center p-3 rounded-sm"
        >
          Unique Words: <span id="count" class="ml-2 text-3xl"></span>
        </div>

        <input type="hidden" id="totalInput" name="wordsTotal" />
        <input type="hidden" id="countInput" name="withoutRepetition" />

        <button
          type="submit"
          class="bg-sky-600 hover:bg-sky-700 transition rounded-md px-6 py-3 text-lg text-white"
        >
          Save Text
        </button>
      </div>
    </form>

    <!-- Table -->
    <% if (textsArr.length === 0) { %>
    <h1 class="mt-20 text-4xl ml-20">No Data Available</h1>
    <% } else { %>
    <table
      class="mt-12 w-full max-w-6xl mx-auto border border-slate-700 rounded-lg overflow-hidden"
    >
      <thead class="bg-slate-800 text-slate-300">
        <tr class="border-b border-slate-700 hover:bg-slate-800 transition">
          <th class="border px-4 py-2 text-left">#</th>
          <th class="border px-4 py-2 text-left">Title</th>
          <th class="border px-4 py-2 text-left">Text</th>
          <th class="border px-4 py-2 text-left">Total Words</th>
          <th class="border px-4 py-2 text-left">Unique Words</th>
          <th class="border px-4 py-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% textsArr.forEach(function(el, index) { %>
        <tr class="border-b border-slate-700 hover:bg-slate-800 transition">
          <td class="px-4 py-3 text-slate-300 text-sm leading-relaxed">
            <%= index + 1 %>
          </td>
          <td class="px-4 py-3 text-slate-300 text-sm leading-relaxed">
            <%= el.title %>
          </td>
          <td class="px-4 py-3 text-slate-300 text-sm leading-relaxed">
            <div
              class="whitespace-nowrap overflow-hidden overflow-ellipsis max-w-[200px]"
            >
              <%= el.text %>
            </div>
          </td>
          <td class="px-4 py-3 text-slate-300 text-sm leading-relaxed">
            <%= el.wordsTotal %>
          </td>
          <td class="px-4 py-3 text-slate-300 text-sm leading-relaxed">
            <%= el.withoutRepetition %>
          </td>
          <td class="px-4 py-3 text-slate-300 text-sm leading-relaxed">
            <div
              style="
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 10px; /* ÿßŸÑŸÖÿ≥ÿßŸÅÿ© ÿ®ŸäŸÜ ÿßŸÑÿπŸÜÿßÿµÿ± */
              "
            >
              <!-- View / Edit button -->
              <a
                style="padding: 4px; margin-right: 8px"
                href="/edit/<%= el.id %>"
                class="bg-blue-600 text-red-400 hover:text-red-300"
              >
                üëÅÔ∏è ‚úèÔ∏è
              </a>
              <!-- Delete button -->
              <button
                class="bg-red-600 text-white px-3 py-1 rounded"
                onclick="openModal('<%= el.id %>')"
              >
                üóëÔ∏è
              </button>
              <!-- copy text icon -->

              <button
                data-text="<%=el.text %>"
                onclick="copyText( this)"
                class="text-3xl"
              >
                üìã
              </button>
            </div>

            <!--  Delete Confirmation Modal -->
            <div
              id="modal-<%= el.id %>"
              class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center z-50"
            >
              <div class="bg-white p-6 rounded-lg shadow-lg w-80">
                <p class="mb-4 text-gray-800">
                  delete <%= el.title ? el.title :"the Text" %> ?
                </p>
                <div class="flex justify-end gap-2">
                  <form action="/delete/<%= el.id %>" method="POST">
                    <button
                      type="submit"
                      class="px-4 py-2 bg-red-600 text-white rounded"
                    >
                      Confirm
                    </button>
                  </form>
                  <button
                    onclick="closeModal('<%= el.id %>')"
                    class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          </td>
        </tr>
        <% }); %>
      </tbody>
    </table>
    <% } %>

    <script>
      // copunting words logic
      function counting() {
        let text = document.getElementById("myText").value;
        const words = text.trim().split(/\s+/).filter(Boolean);
        const uniqueWords = new Set(words);

        document.getElementById("total").innerText = words.length;
        document.getElementById("count").innerText = uniqueWords.size;
        document.getElementById("totalInput").value = words.length;
        document.getElementById("countInput").value = uniqueWords.size;
      }

      //  Modal logic
      function openModal(id) {
        document.getElementById("modal-" + id).classList.remove("hidden");
      }

      function closeModal(id) {
        document.getElementById("modal-" + id).classList.add("hidden");
      }

      // Copy text to clipboard logic
      function copyText(btn) {
        navigator.clipboard
          .writeText(btn.dataset.text)
          .then(() => {
            // console.log("The btn : ", btn);
            // console.log("Text sendet via data-text:", btn.dataset.text);
            btn.innerText = "‚úÖ";
            setTimeout(() => {
              btn.innerText = "üìã";
            }, 300);
          })
          .catch((err) => {
            console.log("Error copying text: ", err);
          });
      }
    </script>
  </body>
</html>
