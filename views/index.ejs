<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body class="bg-indigo-900 text-antiquewhite font-sans text-white">
    <!-- Navbar -->
    <%- include('components/navbar',{currentPage : "home"}) %>

    <!-- Form -->
    <form action="/add" method="POST" class="mt-20 mx-20">
      <input
        type="text"
        id="title"
        name="title"
        placeholder="Text Title"
        class="mb-4 w-6/12 border rounded-lg p-3 text-black bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-600"
      />
      <textarea
        oninput="counting()"
        id="myText"
        name="text"
        class="border rounded-lg p-4 w-full h-40 text-black bg-white"
        placeholder="Put your text here.."
      ></textarea>

      <div class="mt-6 flex gap-10 items-center">
        <div
          class="bg-cyan-700 flex justify-center items-center p-3 rounded-sm"
        >
          Total Words: <span id="total" class="ml-2 text-3xl"></span>
        </div>
        <div
          class="bg-cyan-700 flex justify-center items-center p-3 rounded-sm"
        >
          Unique Words: <span id="count" class="ml-2 text-3xl"></span>
        </div>

        <input type="hidden" id="totalInput" name="wordsTotal" />
        <input type="hidden" id="countInput" name="withoutRepetition" />

        <button type="submit" class="bg-purple-700 rounded-md p-3 text-xl">
          Save Text
        </button>
      </div>
    </form>

    <!-- Table -->
    <% if (textsArr.length === 0) { %>
    <h1 class="mt-20 text-4xl ml-20">No Data Available</h1>
    <% } else { %>
    <table class="mt-10 min-w-fit border border-white mx-20">
      <thead class="bg-orange-600">
        <tr>
          <th class="border px-4 py-2 text-left">#</th>
          <th class="border px-4 py-2 text-left">Title</th>
          <th class="border px-4 py-2 text-left">Text</th>
          <th class="border px-4 py-2 text-left">Total Words</th>
          <th class="border px-4 py-2 text-left">Unique Words</th>
          <th class="border px-4 py-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% textsArr.forEach(function(el, index) { %>
        <tr class="border-b">
          <td class="px-4 py-2"><%= index + 1 %></td>
          <td class="px-4 py-2"><%= el.title %></td>
          <td class="px-4 py-2 max-w-md">
            <div
              class="whitespace-nowrap overflow-hidden overflow-ellipsis max-w-[200px]"
            >
              <%= el.text %>
            </div>
          </td>
          <td class="px-4 py-2"><%= el.wordsTotal %></td>
          <td class="px-4 py-2"><%= el.withoutRepetition %></td>
          <td class="px-4 py-2 flex gap-2">
            <!-- View / Edit button -->
            <button
              href="/edit/<%= el.id %>"
              class="text-green-600 hover:text-green-800 bg-yellow-500 px-3 py-1 rounded"
            >
              üëÅÔ∏è ‚úèÔ∏è
            </button>
            <!-- Delete button -->
            <button
              class="bg-red-600 text-white px-3 py-1 rounded"
              onclick="openModal('<%= el.id %>')"
            >
              Delete
            </button>

            <!--  Delete Confirmation Modal -->
            <div
              id="modal-<%= el.id %>"
              class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center z-50"
            >
              <div class="bg-white p-6 rounded-lg shadow-lg w-80">
                <p class="mb-4 text-gray-800">
                  Are you sure you want to delete "<%= el.title %>"?
                </p>
                <div class="flex justify-end gap-2">
                  <form action="/delete/<%= el.id %>" method="POST">
                    <button
                      type="submit"
                      class="px-4 py-2 bg-red-600 text-white rounded"
                    >
                      Confirm
                    </button>
                  </form>
                  <button
                    onclick="closeModal('<%= el.id %>')"
                    class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </div>

            <!-- copy text icon -->
            <div class="flex items-center gap-2">
              <button onclick="copyText(<%= JSON.stringify(el.text) %>, this)">
                üìã
              </button>
            </div>
          </td>
        </tr>
        <% }); %>
      </tbody>
    </table>
    <% } %>

    <!-- Scripts -->
    <script>
      function counting() {
        let text = document.getElementById("myText").value;
        const words = text.trim().split(/\s+/).filter(Boolean);
        const uniqueWords = new Set(words);

        document.getElementById("total").innerText = words.length;
        document.getElementById("count").innerText = uniqueWords.size;
        document.getElementById("totalInput").value = words.length;
        document.getElementById("countInput").value = uniqueWords.size;
      }

      function openModal(id) {
        document.getElementById("modal-" + id).classList.remove("hidden");
      }

      function closeModal(id) {
        document.getElementById("modal-" + id).classList.add("hidden");
      }

      // Copy text to clipboard logic
      function copyText(text, btn) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            console.log("The btn : ", btn);
            btn.innerText = "‚úÖ";
            setTimeout(() => {
              btn.innerText = "üìã";
            }, 300);
          })
          .catch((err) => {
            console.log("Error copying text: ", err);
          });
      }
    </script>
  </body>
</html>
